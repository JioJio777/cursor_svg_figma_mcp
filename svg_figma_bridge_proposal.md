# SVG-Figma 桥接方案设计

## 方案概述

本方案旨在通过SVG文件作为桥接介质，实现Cursor AI与Figma之间的双向同步，使得AI能够通过生成和修改SVG文件来间接绘制Figma设计。

## 技术架构

```
┌─────────────┐      ┌───────────────┐      ┌─────────┐
│  Cursor AI  │◄────►│  SVG文件目录  │◄────►│  Figma  │
└─────────────┘      └───────────────┘      └─────────┘
     AI生成           本地存储桥接          设计展示与编辑
```

### 核心组件

1. **本地SVG文件目录**：存储所有页面的SVG文件，每个文件代表一个Figma页面
2. **页面索引文件**：JSON格式，维护SVG文件与Figma页面的映射关系
3. **WebSocket服务器**：负责Cursor与Figma插件之间的通信
4. **Figma插件**：处理SVG导入导出，实现页面同步

## 实现细节

### 1. 页面标识与映射

- 每个SVG文件使用页面级别ID进行标识（不考虑组件级别）
- 在SVG根元素中嵌入ID属性（例如：`<svg id="page-homepage-001" ...>`）
- 通过JSON索引文件维护映射关系：

```json
{
  "pages": [
    {
      "id": "page-homepage-001",
      "name": "Homepage",
      "svgFile": "homepage.svg",
      "figmaId": "123:456",
      "position": { "x": 0, "y": 0 }
    },
    ...
  ]
}
```

### 2. 双向同步机制

#### 本地 → Figma同步

1. AI或用户修改本地SVG文件
2. 通过WebSocket将SVG内容发送到Figma插件
3. 插件根据SVG的ID查找现有页面
4. 若找到匹配页面，删除原页面并完全替换为新导入SVG
5. 更新页面位置和JSON索引文件中的映射关系

#### Figma → 本地同步

1. 用户在Figma中修改设计
2. 用户触发导出操作
3. 插件将页面导出为SVG，并通过WebSocket发送到本地
4. 本地根据页面ID更新对应SVG文件
5. 更新JSON索引文件中的映射关系

### 3. 页面关系管理

- 在JSON索引文件中存储页面之间的连接关系
- Figma中的页面位置反映页面间的逻辑关系
- 通过位置信息维护页面之间的导航和链接

## 技术挑战与解决方案

### 1. SVG与Figma兼容性

**挑战**：SVG导入Figma过程中可能有少量样式丢失
**解决方案**：接受小概率样式丢失现象，专注于保持页面结构和主要内容的一致性

### 2. 页面定位

**挑战**：导入SVG后页面位置可能发生变化
**解决方案**：在替换前记录原页面位置，导入后恢复到原位置

### 3. 并发编辑冲突

**挑战**：同时从本地和Figma修改同一页面会导致冲突
**解决方案**：实现基于时间戳的简单冲突检测，或建议用户避免并发编辑

## 实施路线

1. **阶段一**：实现本地SVG文件目录结构和索引机制
2. **阶段二**：扩展现有WebSocket服务，支持双向同步
3. **阶段三**：增强Figma插件，支持页面级别ID和精确替换
4. **阶段四**：开发AI绘制界面，支持通过指令生成和修改SVG

## 结论

通过SVG文件作为桥接介质，可以在不直接修改Figma API的情况下，实现AI与Figma之间的间接沟通。此方案结构简单、实现难度适中，能够满足AI辅助设计的基本需求。 